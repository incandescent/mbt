/*!
 * jQueryMobile-router v0.9
 * http://github.com/azicchetti/jquerymobile-router
 *
 * Copyright 2011 (c) Andrea Zicchetti
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://github.com/azicchetti/jquerymobile-router/blob/master/MIT-LICENSE.txt
 * http://github.com/azicchetti/jquerymobile-router/blob/master/GPL-LICENSE.txt
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{b(jQuery)}}(this,function(a){a(document).bind("mobileinit",function(){var d=a.extend({fixFirstPageDataUrl:false,firstPageDataUrl:"index.html",ajaxApp:false,firstMatchOnly:false},a.mobile.jqmRouter||{});var c=true;function b(g){if(c){console.log(g)}}var e=null,f=null;a(document).bind("pagebeforechange",function(k,j){var h=(typeof j.toPage==="string")?j.toPage:j.toPage.jqmData("url")||"";if(j.options.hasOwnProperty("_jqmrouter_handled")){return}j.options._jqmrouter_handled=true;var g=a.mobile.path.parseUrl(h);e=f;f=g;if(g.hash.indexOf("?")!==-1){var i=g.hash.replace(/\?.*$/,"");j.options.dataUrl=g.href;if(a.mobile.activePage&&i.replace(/^#/,"")==a.mobile.activePage.jqmData("url")){j.options.allowSamePageTransition=true;a.mobile.changePage(a(i),j.options)}else{a.mobile.changePage(a(i),j.options)}k.preventDefault();a.mobile.urlHistory.ignoreNextHashChange=true}});if(d.fixFirstPageDataUrl){a(document).ready(function(){if(!window.location.pathname.match("/$")){return}var h=a(":jqmData(role='page')").first();var i=h.jqmData("url"),g=window.location.pathname+d.firstPageDataUrl+window.location.search+window.location.hash;if(i!=g){h.attr("data-url",g).jqmData("url",g)}})}a.mobile.Router=function(k,h,j){this.routes={pagebeforecreate:null,pagecreate:null,pagebeforeshow:null,pageshow:null,pagebeforehide:null,pagehide:null,pageinit:null,pageremove:null,pagebeforechange:null,pagebeforeload:null,pageload:null};this.evtLookup={bC:"pagebeforechange",bl:"pagebeforeload",l:"pageload",bc:"pagebeforecreate",c:"pagecreate",bs:"pagebeforeshow",s:"pageshow",bh:"pagebeforehide",h:"pagehide",i:"pageinit",rm:"pageremove"};this.routesRex={};this.conf=a.extend({},d,j||{});this.defaultHandlerEvents={};if(this.conf.defaultHandlerEvents){var g=this.conf.defaultHandlerEvents.split(",");for(var l=0;l<g.length;l++){this.defaultHandlerEvents[this.evtLookup[g[l]]]=g[l]}}this.add(k,h)};a.extend(a.mobile.Router.prototype,{documentEvts:{pagebeforechange:1,pagebeforeload:1,pageload:1},add:function(j,i,l){if(!j){return}var g=this,h=[],m=[];if(j instanceof Array){a.each(j,a.proxy(function(o,n){this.add(n,i,true)},this))}else{a.each(j,function(s,p){if(typeof(p)=="string"||typeof(p)=="function"){if(g.routes.pagebeforeshow===null){g.routes.pagebeforeshow={}}g.routes.pagebeforeshow[s]=p;if(!g.routesRex.hasOwnProperty(s)){g.routesRex[s]=new RegExp(s)}}else{var o,q=p.events.split(","),n;for(o=0;o<q.length;o++){n=g.evtLookup[q[o]];if(g.routes.hasOwnProperty(n)){if(g.routes[n]===null){g.routes[n]={}}g.routes[n][s]=p.handler;if(!g.routesRex.hasOwnProperty(s)){g.routesRex[s]=new RegExp(s)}}else{b("can't set unsupported route "+q[o])}}}})}if(l===true){return}if(!this.userHandlers){this.userHandlers=i||{}}else{a.extend(this.userHandlers,i||{})}a.each(g.routes,function(n,o){if(o!==null){if(!g.documentEvts[n]){h.push(n)}else{m.push(n)}}});this._detachEvents();var k=function(o,n){g._processRoutes(o,n,this)};if(h.length>0){this._eventData={events:h.join(" "),selectors:":jqmData(role='page'),:jqmData(role='dialog')",handler:k};a(document).delegate(this._eventData.selectors,this._eventData.events,this._eventData.handler)}if(m.length>0){this._docEventData={events:m.join(" "),handler:k};a(document).bind(this._docEventData.events,this._docEventData.handler)}},_processRoutes:function(l,p,m){var n=this,o,h,k,g=0;if(l.type in {pagebeforehide:true,pagehide:true,pageremove:true}){o=e}else{o=f}do{if(!o){if(m){k=a(m);o=k.jqmData("url");if(o){if(k.attr("id")==o){o="#"+o}o=a.mobile.path.parseUrl(o)}}}else{if(!this.documentEvts[l.type]&&m&&!a(m).jqmData("url")){return}}if(!o){return}h=(!this.conf.ajaxApp?o.hash:o.pathname+o.search+o.hash);if(h.length==0){o=""}g++}while(h.length==0&&g<=1);var j=false;a.each(this.routes[l.type],function(q,s){var r,u;if((r=h.match(n.routesRex[q]))){if(typeof(s)=="function"){u=s}else{if(typeof(n.userHandlers[s])=="function"){u=n.userHandlers[s]}}if(u){try{u.apply(n.userHandlers,[l.type,r,p,m,l]);j=true}catch(t){b(t)}}}if(j&&n.conf.firstMatchOnly){return false}});if(!j&&this.conf.defaultHandler&&this.defaultHandlerEvents[l.type]){if(typeof(this.conf.defaultHandler)=="function"){try{this.conf.defaultHandler.apply(n.userHandlers,[l.type,p,m,l])}catch(i){b(i)}}}},_detachEvents:function(){if(this._eventData){a(document).undelegate(this._eventData.selectors,this._eventData.events,this._eventData.handler)}if(this._docEventData){a(document).unbind(this._docEventData.events,this._docEventData.handler)}},destroy:function(){this._detachEvents();this.routes=this.routesRex=null},getParams:function(g){if(!g){return null}var j={},h;var i=g.slice(g.indexOf("?")+1).split("&");a.each(i,function(m,l){h=l.split("=");h[0]=decodeURIComponent(h[0]);if(j[h[0]]){if(!(j[h[0]] instanceof Array)){j[h[0]]=[j[h[0]]]}j[h[0]].push(decodeURIComponent(h[1]))}else{j[h[0]]=decodeURIComponent(h[1])}});if(a.isEmptyObject(j)){return null}return j}})});return{}}));